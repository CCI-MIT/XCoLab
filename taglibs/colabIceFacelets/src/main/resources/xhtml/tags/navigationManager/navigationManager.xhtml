<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:collab="http://climatecollaboratorium.org/facelets"
    xmlns:liferay-faces="http://liferay.com/tld/faces">
    <ice:panelGroup styleClass="navigationManagerForm hidden">
        <ice:form>
            <ice:inputText value="#{navigationManagerBean.navigationToken}" styleClass="navigationToken" />
            <ice:commandButton value="Submit" styleClass="submit" action="#{navigationManagerBean.navigate}" />
        </ice:form>
        <ice:form>
            <ice:commandButton value="Submit" styleClass="submitLrPing" action="#{navigationManagerBean.ping}" />
        </ice:form>
	<ice:panelGroup>
        <script type="text/javascript">
            var lastTrackedToken = 0;
        </script>
    
    </ice:panelGroup>
    <ice:panelGroup>
        <div id="tokenNumberNav" class="hidden">#{navigationManagerBean.token}</div>
		<script type="text/javascript">
        /* ping disabled */
        /*
            if (typeof(window.lrPingRunning) == 'undefined') { 
                window.lrPingRunning = false;
            }
            
            function runLrPing() {
                jQuery(".submitLrPing").click();
                setTimeout(runLrPing, 30000);
            }
            
			// #{navigationManagerBean.token}
			jQuery(document).ready(function() {
				if (#{navigationManagerBean.token} > 0) {
					Collab.nav.unblock();
				}
                if (#{navigationManagerBean.token} > 1 &amp;&amp; #{navigationManagerBean.token} != lastTrackedToken) {
                    // track page view, first page entry should be done with top level pageTracker (in theme)
                    try {
                        var path = window.location.pathname + window.location.search + window.location.hash;
                        var pageTracker = _gat._getTracker("UA-11944310-1");
                        pageTracker._setAllowAnchor(true);
                        pageTracker._trackPageview(path);
                        lastTrackedToken = #{navigationManagerBean.token};
                    } catch(err) {}
                }
                if (!window.lrPingRunning) {
                    window.lrPingRunning = true;
                    runLrPing();
                }
			});
            */
		</script>
	</ice:panelGroup>
    </ice:panelGroup>
</f:view>
