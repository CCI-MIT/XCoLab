<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:liferay-faces="http://liferay.com/tld/faces"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ice="http://www.icesoft.com/icefaces/component">

	<f:subview rendered="#{reg.registrationSuccessful}">
		<script type="text/javascript">
			location.href = "/";
		</script>
	</f:subview>

	<ice:form>

		<script type="text/javascript"
			src="/html/js/editor/ckeditor/ckeditor.js">
			
		</script>


		<div class="popupreg_form">
			<div class="popupreg_head">
				<h1>Join the CoLab</h1>
			</div>


			<div class="is-required">
				<img src="/climatecolab-theme/images/reg-star.png" width="8"
					height="7" align="texttop" /> is a required field.
			</div>


			<f:subview rendered="${ error != null and isRegistering }">
				<div class="error-message">${error}</div>
			</f:subview>

			<table border="0" class="reg">
				<tr>
					<th nowrap="nowrap">Screen name <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td><ice:inputText id="screenName" value="#{reg.screenName}"
							styleClass="popupreg_input" required="true">
							<f:validator validatorId="screenNameValidator" />
						</ice:inputText> <br />
						<div class="reg_errors">
							<ice:message for="screenName" styleClass="alert alert-error" />
						</div></td>

					<th class="second" rowspan="4" nowrap="nowrap">Photo</th>
					<td rowspan="4"><ice:panelGroup>
							<f:subview rendered="#{empty reg.uploadedFileName}">
								<img src="/climatecolab-theme/images/reg_emptyavatar.png"
									width="150" height="150" alt="#{reg.screenName}" />
							</f:subview>
							<f:subview rendered="#{not empty reg.uploadedFileName}">
								<img
									src="/registration-portlet/ShowUploadedAvatarImg?fileName=#{reg.uploadedFileName}"
									width="150" height="150" alt="#{reg.screenName}" />
							</f:subview>
						</ice:panelGroup> <ice:panelGroup styleClass="profile_upload">
							<ice:inputFile id="profileImage"
								actionListener="#{reg.uploadPortrait}" styleClass="filepc"
								autoUpload="true">
								<ice:outputStyle href="/css/main.css" />
							</ice:inputFile>
							<br />

							<script type="text/javascript">
								monitorUploadFrame();
							</script>
						</ice:panelGroup> <f:subview rendered="#{not empty reg.fileErrorMessage}">
							<div class="reg_errors">
								#{reg.fileErrorMessage}
								<ice:message for="profileImage" styleClass="form_error_message" />
							</div>
						</f:subview></td>

				</tr>
				<tr>
					<th nowrap="nowrap">Email <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td><ice:inputText id="email" value="#{reg.email}"
							styleClass="popupreg_input" required="true">
							<f:validator validatorId="emailValidator" />
						</ice:inputText> <br />
						<div class="reg_errors">
							<ice:message for="email" styleClass="alert alert-error" />
						</div></td>
				</tr>
				<tr>
					<th nowrap="nowrap">First name <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td><ice:inputText id="firstName" value="#{reg.firstName}"
							styleClass="popupreg_input" required="true" /><br />
						<div class="reg_errors">
							<ice:message for="firstName" styleClass="alert alert-error" />
						</div></td>
				</tr>
				<tr>
					<th nowrap="nowrap">Last name <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td><ice:inputText id="lastName" value="#{reg.lastName}"
							styleClass="popupreg_input" required="true" /><br />
						<div class="reg_errors">
							<ice:message for="lastName" styleClass="alert alert-error" />
						</div></td>
				</tr>
				<tr>
					<th nowrap="nowrap">Password <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td>#{reg.password} <ice:inputSecret id="password"
							value="#{reg.password}" styleClass="popupreg_input"
							required="true">

							<f:attribute name="type" value="new" />
						</ice:inputSecret> <br />
						<div class="reg_errors">
							<ice:message for="password" styleClass="alert alert-error" />
						</div></td>
				</tr>
				<tr>
					<th nowrap="nowrap">Retype Password <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td><ice:inputSecret id="retypePassword"
							value="#{reg.retypePassword}" styleClass="popupreg_input"
							required="true">

							<f:attribute name="type" value="newRetype" />
						</ice:inputSecret><br />
						<div class="reg_errors">
							<ice:message for="reypePassword" styleClass="alert alert-error" />
						</div></td>

					<th class="second">Country</th>
					<td><ice:inputText id="country" value="#{reg.country}"
							styleClass="popupreg_input" /><br />
						<div class="reg_errors">
							<ice:message for="country" styleClass="alert alert-error" />
						</div></td>
				</tr>

				<tr>
					<th nowrap="nowrap">Short Bio</th>
					<td colspan="3"><ice:panelGroup styleClass="userProfileAbout">
							<ice:inputTextarea rows="6" cols="30" styleClass="ckeditor"
								value="#{reg.about}" onblur="return false;" />
						</ice:panelGroup> <script type="text/javascript">
							function updateTextarea() {
								for ( var instance in CKEDITOR.instances) {
									CKEDITOR.instances[instance]
											.updateElement();
								}
							}
						</script></td>
				</tr>
				
				  		
    		<tr>
    			<th nowrap="nowrap">Retype the words <img src="/climatecolab-theme/images/reg-star.png" width="8" height="7" align="texttop" /></th>
    			<td colspan="3">
    			    <script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>
				    <script type="text/javascript">
				        function populateCaptchaFields() {
				            jQuery(".captchaText").val(Recaptcha.get_response());
				            jQuery(".captchaChallenge").val(Recaptcha.get_challenge());
				        }
				        function initRecaptcha() {
				            Recaptcha.destroy();
				            Recaptcha.create("#{reg.captchaPublicKey}", "recaptcha_div", {});
				        }
				    </script>
				    <script type="text/javascript">
                            // #{contactBean.tryNumber}
                            
                            try {
                            jQuery(document).ready(function() {
                                initRecaptcha();

                            });
                            }
                            catch (e) { alert(e);}
                            
                        </script>
                        <ice:inputText id="captchaChallenge" value="#{reg.captchaChallenge}" styleClass="hidden captchaChallenge" required="true"></ice:inputText>
                        <ice:inputText id="captcha" value="#{reg.captchaText}" styleClass="hidden captchaText" required="true" >
                            <!-- <f:validator validatorId="captchaValidator" /> -->
                            <f:attribute name="challengeId" value="captchaChallenge" />
                        </ice:inputText>
                        
                        
                        <div id="recaptcha_div"></div>
                        
                        <ice:message for="captcha" />
	    		</td>
    		</tr>

				<tr>
					<th nowrap="nowrap">Terms of use <img
						src="/climatecolab-theme/images/reg-star.png" width="8" height="7"
						align="texttop" /></th>
					<td class="popupreg_terms-right" colspan="3">By registering
						for this site, you agree to abide<br /> by the <a
						href="/web/guest/resources/-/wiki/Main/Terms+of+use">Terms of
							Use</a>
					</td>
				</tr>

			</table>

		</div>
		<div class="clearfix"></div>


		<div class="blue-button">
			<ice:commandLink actionListener="#{reg.register}"
				onclick="updateTextarea();populateCaptchaFields();">Save</ice:commandLink>
		</div>
		<div class="blue-button">
			<a href="/web/guest/">Cancel</a>
		</div>
		<!-- <input type="reset" name="reset" class="profile_reset" value="CANCEL" />-->

	</ice:form>
	<ice:form>

		<ice:commandLink styleClass="hidden signalPictureUploaded"
			actionListener="#{reg.signalPictureUploaded}" partialSubmit="true" />
	</ice:form>
</f:view>