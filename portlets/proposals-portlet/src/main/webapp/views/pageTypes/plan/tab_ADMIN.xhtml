<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collab="http://climatecollaboratorium.org/facelets"
        xmlns:ui="http://java.sun.com/jsf/facelets" 
        xmlns:fn="http://java.sun.com/jsp/jstl/functions">    
        

   <style type="text/css">
    .admin_left {
        width: 400px;
        float: left;
    }
    .admin_right {
        float: left;
    }
   </style>
   <ice:form>
    <div class="admin_left">
        <div class="addpropbox">
            <strong>This proposal can be edited by:</strong>
            <div>
                <ice:selectOneRadio value="#{planBean.plan.planMode}" layout="pageDirection" partialSubmit="true">
                    <f:selectItems value="#{planBean.plan.allPlanModes}"></f:selectItems>
                </ice:selectOneRadio>                
            </div>        
        </div>
        <!-- 
        <h2>Ask for help:</h2>
        <div class="admin_box">
            <ice:selectManyCheckbox value="#{planBean.plan.helpStatus}" partialSubmit="true" styleClass="plan-mode-select">
                <f:selectItems value="#{planBean.plan.allHelpStatuses}"></f:selectItems>    
            </ice:selectManyCheckbox>
        </div>
         --> 
        
        <ice:panelGroup rendered="#{permissions.canAdminAll and contest.currentPhase.hasNextPhase and !planBean.plan.promoted}" styleClass="addpropbox blue">
            <strong>Promote to next phase</strong>
            <div>           
                <div class="blue-button">
                    <ice:commandLink actionListener="#{planBean.plan.promote}" onclick="if(!confirm('Are you sure you want to proceed with promoting this plan?')){ return false; }">
                        <span>PROMOTE</span> plan to next phase
                    </ice:commandLink>
                </div> 
            </div>
        </ice:panelGroup>
        
        <ice:panelGroup rendered="#{permissions.canAdminAll and planBean.plan.place le 0}"  styleClass="addpropbox blue">
            <strong>Mark as semi-finalist</strong>
            <div>  
                <div class="blue-button">
                    <ice:commandLink actionListener="#{planBean.plan.markAsSemiFinalist}" onclick="if(!confirm('Are you sure you want to proceed with marking this proposal as semi finalist?')){ return false; }">
                        <span>MARK</span> as semi-finalist
                    </ice:commandLink>
                </div> 
            </div>
        </ice:panelGroup>
        
        <ice:panelGroup rendered="#{permissions.canAdminAll and planBean.plan.place == 2}"  styleClass="addpropbox">
            <strong>Remove semi-finalist ribbon</strong>
            <div>
                <div class="blue-button">
                    <ice:commandLink actionListener="#{planBean.plan.removeSemiFinalistRibbon}" onclick="if(!confirm('Are you sure you want to remove semi-finalist ribbon?')){ return false; }">
                        <span>REMOVE</span> semi-finalist ribbon
                    </ice:commandLink>
                    
                </div> 
            </div>
        </ice:panelGroup>
        
        <ice:panelGroup rendered="#{permissions.canAdminAll}">
            <div  class="addpropbox">
                <strong>Set ribbon type (integer value 1 to 3)</strong>
                <div>
                    <ice:inputText value="#{planBean.plan.ribbon}" partialSubmit="true" /> 
                </div>
                <br />
                <strong>Set ribbon text (it will be shown when user hovers over the ribbon)</strong>
                <div>
                    <ice:inputText value="#{planBean.plan.ribbonText}" partialSubmit="true" /> 
                </div>
            </div>
        </ice:panelGroup>
        <!-- 
        <ice:panelGroup rendered="#{permissions.canAdminAll}">
            <div class="addpropbox blue">
                <strong>Scrapbook</strong>
            
                  <div>
                    <f:subview rendered="#{planBean.plan.scrapbook}">
                        <div class="blue-button">
                            <ice:commandLink actionListener="#{planBean.plan.toggleScrapbook}">
                                <span>REMOVE</span> scrapbook mark
                            </ice:commandLink>
                        </div>
                    </f:subview>
                    <f:subview rendered="#{not planBean.plan.scrapbook}">
                        <div class="blue-button">
                            <ice:commandLink actionListener="#{planBean.plan.toggleScrapbook}">
                                <span>MARK</span> proposal as a scrapbook
                            </ice:commandLink>
                        </div>
                    </f:subview>
                
                </div>
                    <br />
          
            <strong>Scrapbook hover text</strong>
            <div>
                  <ice:inputText value="#{planBean.plan.scrapbookText}" partialSubmit="true" /> 
            </div>
          </div>
        </ice:panelGroup>
         -->
        
        <ice:panelGroup rendered="#{permissions.canAdminAll}">
            <div class="addpropbox blue">
                <strong>Proposal tags (featured etc...)</strong>
                <div>
                    <ice:inputText value="#{planBean.plan.tags}" partialSubmit="true" /> 
                </div>
          
                <strong>Proposal tags hover text</strong>
                <div>
                    <ice:inputText value="#{planBean.plan.tagsHover}" partialSubmit="true" /> 
                </div>
                
                <strong>Tagged proposal weight (for sorting)</strong>
                <div>
                    <ice:inputText value="#{planBean.plan.tagsOrder}" partialSubmit="true" /> 
                </div>
          </div>
        </ice:panelGroup>
        
        <ice:panelGroup rendered="#{permissions.planOwner}" styleClass="addpropbox">
            <strong>Owner actions</strong>
            
            <div>
                <div class="blue-button">
                    <ice:commandLink rendered="#{permissions.canAdmin}"  actionListener="#{planBean.plan.delete}" onclick="if(!confirm('Are you sure you want to proceed with removal?')){ return false; }">
                        DELETE plan
                    </ice:commandLink>
                </div>
            </div>
        </ice:panelGroup>
    
    </div>
    
    
    <div class="admin_right">
        <div class="addpropbox">
        <strong>Membership requests</strong>
        <ice:panelGroup rendered="#{fn:length(planBean.membershipBean.planMembershipRequests) lt 1}">
            <i>No new requests</i>
        </ice:panelGroup>
        <ice:dataTable value="#{planBean.membershipBean.planMembershipRequests}" var="membershipRequest" styleClass="colab adm" rendered="#{fn:length(planBean.membershipBean.planMembershipRequests) gt 0}" rowClasses="t,nt">
            <ice:column>
                <strong><collab:userLinkSimple userId="#{membershipRequest.userId}" text="#{membershipRequest.screenName}" /></strong>
            </ice:column>
            <!-- 
            <ice:column>
                <ice:outputText value="#{membershipRequest.requestDate}" />
            </ice:column>
            -->
            <ice:column rendered="#{permissions.canAdmin}">
                <div class="blue-button">
                    <a href="javascript:;" onclick="showManageMembershipRequestDialog('manage_membership_request_#{membershipRequest.id}')">
                        View
                    </a>                     
                </div>                                                     
                <div id="manage_membership_request_#{membershipRequest.id}">
                    <div class="content hidden">
                        <div class="manageMembersTop">
                            <h4>Respond to membership request</h4>
                        </div>
                        <div class="manageMembersContent">
                            User comment:
                            <p class="userComment">
                                <ice:outputText value="#{membershipRequest.comment}" />
                            </p>
                            Optional message to requestor:<br />
                                <ice:inputTextarea value="#{membershipRequest.response}" styleClass="membershipRequestResponse" />
                            Action:
                            <strong>
                                <ice:selectOneRadio value="#{membershipRequest.approve}">
                                    <f:selectItem itemValue="true" itemLabel="approve" />
                                    <f:selectItem itemValue="false" itemLabel="deny" />
                                </ice:selectOneRadio>
                            </strong>
                        </div>
                        <div class="manageMembersActions">
                            <div class="blue-button">
                                <a href="javascript:;" onclick="respondToMembershipRequest('manage_membership_request_#{membershipRequest.id}')">OK</a>
                            </div>
                            <div class="blue-button">
                                <a href="javascript:;" onclick="hideManageMembershipRequestDialog('manage_membership_request_#{membershipRequest.id}')">Cancel</a>
                            </div>
                        </div>
                    </div>
                    <ice:commandLink actionListener="#{membershipRequest.update}" styleClass="hidden membershipRequestResponseSubmitButton" />
                </div>
            </ice:column>

        </ice:dataTable>
        <div id="manage_membership_request_dialog"></div>
        </div>
        
        <div class="addpropbox blue">
        <strong>History</strong>
        <table class="colab adm2">
            <ui:repeat value="#{planBean.plan.allVersions}" var="planVersion">
                <tr class="createdate">
                    <td class="createdate">
                        <ice:outputText value="#{planVersion.updateDate}">
                            <f:convertDateTime pattern="MM/dd/yy hh:mm a"/>
                        </ice:outputText>
                    </td>
                </tr>
                <tr class="t">
                    <td width="210" class="b">
                        <strong><collab:userLinkSimple userId="#{planVersion.updateAuthor.userId}" text="#{planVersion.updateAuthor.screenName}" /></strong>
                    </td>
                    <td>
                        <strong>#{planVersion.updateType}</strong>
                    </td>
                </tr>
        
            </ui:repeat>
        </table>
        </div>
    </div>
   <!--  if plan has been deleted, redirect user to plansIndex -->
    
    <f:subview rendered="#{planBean.plan.deleted}">    
        <script language="javascript">
            Collab.nav.navigate("plans", {});
        </script>
    
    </f:subview>
    
    </ice:form>
</f:view>