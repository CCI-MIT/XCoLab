<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:liferay-faces="http://liferay.com/tld/faces" xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:collab="http://climatecollaboratorium.org/components">

<div class="plansIndex">
<ice:panelGroup styleClass="categoryDetails">
    <ice:form>
        <div class="categoryHeader">
            <ice:outputConnectionStatus/>
            <h2><ice:outputText styleClass="categoryName" value="#{plansIndexBean.contestPhase.contest.name}"/></h2>

        </div>
        <ice:panelGroup styleClass="categoryDescription">
            <ice:outputText value="#{plansIndexBean.contestPhase.contest.description}"/>
        </ice:panelGroup>
    </ice:form>
</ice:panelGroup>

<ice:form>
    <ui:include src="./configureColumns.xhtml">
        <ui:param value="#{plansIndexBean.columnsConfiguration}" name="columnsConfiguration"/>
    </ui:include>
    <ui:include src="./filterPlans.xhtml">
        <ui:param value="#{plansIndexBean.filterPlansBean}" name="filterPlans"/>
    </ui:include>
    <ui:include src="./createPlan.xhtml">
        <ui:param value="#{navigation.createPlanBean}" name="createPlanBean"/>
    </ui:include>
</ice:form>
<ice:form>
    <div class="floatRight linkbox">
        <a class="configuration black" href="javascript:;"
           onclick="showConfigureColumnsDialog()">Select Columns</a>
        <span>|</span>
        <a class="preferences black" href="javascript:;"
           onclick="showFilterPlansDialog()">Filter Plans</a>
        <span>|</span>
                        <span class="enable-filters">
                            <ice:selectBooleanCheckbox value="#{plansIndexBean.filterPlansBean.enabled}"
                                                       styleClass="filtersEnabledCheckbox"
                                                       onclick="toogleFiltersEnabled()">
                                Enable filter
                            </ice:selectBooleanCheckbox>
                        </span>
    </div>

    <ice:panelTabSet id="contestTabs"
                     var="contestPhase"
                     styleClass="contestTabSet"
                     
                     value="#{plansIndexBean.contestPhases}"
                     tabPlacement="top"
                     selectedIndex="#{plansIndexBean.contestPhaseIndex}">
        <ice:panelTab label="#{contestPhase.name}" styleClass="myTabStyle">


            <div class="phaseInfoPanel">
                <table>
                    <tr>
                        <td>
                            <h2 class="phaseStatus"><ice:outputText
                                    value="#{plansIndexBean.contestPhase.status}"></ice:outputText></h2>
                            <span class="phaseInfo">(#{plansIndexBean.plansCount} plans, #{plansIndexBean.votesCount} total votes)</span>

                            <div class="dateInfo"><span class="phaseDateLabel">Start:</span><ice:outputText
                                    value="#{plansIndexBean.contestPhase.startDate}"><f:convertDateTime type="date" dateStyle="short"/>
                         </ice:outputText>&#160;<span
                                    class="phaseDateLabel">End:</span><ice:outputText
                                    value="#{plansIndexBean.contestPhase.endDate}">
                                        <f:convertDateTime type="date" dateStyle="short"/>
                         </ice:outputText>

                            </div>
                        </td>
                        <td class="button">
                            <ice:commandButton onclick="if(!deferUntilLogin()) return false;"
                                               styleClass="prominantButton"
                                               actionListener="#{navigation.createPlanBean.createPlan}"
                                               rendered="#{plansIndexBean.contestPhase.canEdit}"
                                               value="Create new plan"/>
                        </td>
                    </tr>
                </table>


            </div>
            <div class="tabContent_bottom">

                <div class="clear"></div>

                <ice:dataTable value="#{plansIndexBean.plans}" styleClass="plansTable" rowClasses="odd,even"
                               var="singlePlan" sortColumn="#{plansIndexBean.sortColumn}"
                               sortAscending="#{plansIndexBean.sortAscending}" id="plansIndex"
                               rows="#{plansIndexBean.pageSize}" headerClass="#{plansIndexBean.columns}">
                    <ice:columns value="#{plansIndexBean.columns}" var="column">
                        <f:facet name="header">
                            <div>
                                <div class="popup-info-box hidden"
                                     id="info-popup-#{column}">#{column.description}</div>
                                
                                <div class="clear"></div>
                                <ice:commandSortHeader styleClass="column-hover" columnName="#{column}">
                                    <ice:outputText id="column-#{column}" value="#{column.name}" escape="false"/>
                                </ice:commandSortHeader>
                            </div>
                        </f:facet>
                        <ice:outputLink
                                value="#plans=phaseId:#{singlePlan.contestPhaseId},planId:#{singlePlan.planId};"
                                rendered="#{column == 'NAME'}"
                                >
                            <ice:outputText value="#{singlePlan.columnValues[column]}" styleClass="#{column}" escape="true" />
                        </ice:outputLink>
                        <f:subview rendered="#{column == 'POSITIONS' and !singlePlan.hasPositions}">
                            N/A
                        </f:subview>
                        <f:subview rendered="#{column == 'POSITIONS' and singlePlan.hasPositions}">
                            <a href="javascript:;" class="showPositions"
                               onclick="showPositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}');return;"/>

                            <div class="hidden" id="plan_positions_#{singlePlan.planId}">
                                <div class="positionsDialog">
                                    <div class="positionsDialog_top">
                                        <div class="title"><h2>Positions for <ice:outputText value="#{singlePlan.planName}" escape="true" /></h2></div>
                                    </div>
                                    <div class="positionsDialog_bg">
                                        <div class="scrollBox">
                                            <ice:panelSeries value="#{singlePlan.positions}" var="question">
                                                <div class="assumption">
                                                    <h3 class="question">#{question.debateAnchor}</h3>
                                                    <h4 class="position">#{question.selectedPosition.itemAnchor}</h4>
                                                </div>
                                            </ice:panelSeries>
                                        </div>
                                    </div>
                                    <div class="positionsDialog_bottom">
                                        <a href="javascript:;"
                                           onclick="hidePositionsOnIndexPageDialog('plan_positions_#{singlePlan.planId}')">Close</a>
                                    </div>
                                </div>
                            </div>
                        </f:subview>

                        <ice:outputText value="#{singlePlan.columnValues[column]}"
                                        rendered="#{column != 'NAME' and column != 'POSITIONS'}" escape="true"/>
                    </ice:columns>
                    <ice:column rendered="#{plansIndexBean.contestPhase.canVote}">
                        <f:facet name="header">
                            <div class="voteForPlan"><span>Vote for Plan</span></div>
                        </f:facet>
                        <ice:commandLink actionListener="#{singlePlan.vote}"
                                         onclick="if(! deferUntilLogin()) return false; "
                                         styleClass="indexVoteForPlan #{singlePlan.votedOn ? 'en userVote' : 'dis'} "></ice:commandLink>
                    </ice:column>
                </ice:dataTable>
                <ice:panelGroup styleClass="hidden">
                    #{plansIndexBean.plans}
                    <script language="javascript">
                        initializeColumnsInfo();
                        makeNANotesVisible();
                    </script>
                </ice:panelGroup>

                <div class="pageBottom">

                    <div class="pageNum">


                        <ice:dataPaginator id="dataScroll_2" for="plansIndex" rowsCountVar="rowsCount"
                                           displayedRowsCountVar="displayedRowsCountVar"
                                           firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
                                           pageCountVar="pageCount" pageIndexVar="pageIndex"
                                           styleClass="paginatorInfo">
                            <ice:outputFormat
                                    value="Displaying &lt;strong&gt;{0}&lt;/strong&gt; - &lt;strong&gt;{1}&lt;/strong&gt; of &lt;strong&gt;{2}&lt;/strong&gt; Plans"
                                    styleClass="paginatorInfo" escape="false">
                                <f:param value="#{firstRowIndex}"/>
                                <f:param value="#{lastRowIndex}"/>
                                <f:param value="#{rowsCount}"/>
                            </ice:outputFormat>
                        </ice:dataPaginator>

                        <ice:dataPaginator id="dataScroll_1" rendered="true" for="plansIndex" paginator="true"
                                           paginatorMaxPages="1" styleClass="paginator">
                            <f:facet name="first">
                                <ice:panelGroup>
                                    <ice:outputText value="First Page" styleClass="first"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="last">
                                <ice:panelGroup>
                                    <ice:outputText value="Last Page" styleClass="last"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="previous">
                                <ice:panelGroup>
                                    <ice:outputText value="Previous" styleClass="prev"/>
                                </ice:panelGroup>
                            </f:facet>
                            <f:facet name="next">
                                <ice:panelGroup>
                                    <ice:outputText value="Next" styleClass="next"/>
                                </ice:panelGroup>
                            </f:facet>
                        </ice:dataPaginator>

                        <div class="clear"></div>
                    </div>
                    <div class="clear"></div>
                </div>


                <div class="clear"></div>
            </div>
        </ice:panelTab>

    </ice:panelTabSet>
</ice:form>
</div>
</f:view>
