<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets" 
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:collab="http://climatecollaboratorium.org/facelets">

    <ice:commandLink styleClass="editButton editStateTrigger hidden" value="Edit" actionListener="#{planBean.planPositionsBean.edit}"/>
    <ice:panelGroup styleClass="hidden">
        <script type="text/javascript">
            Collab.nav.addEditorDirtyValidationCallback(checkIfPlanPositionsDirty);
        </script>
    </ice:panelGroup>
    
    
    <ui:decorate template="breadcrumb.xhtml">
        <ui:define name="breadcrumbButtons">
        <!-- 
            <ice:panelGroup styleClass="breadbutt" rendered="#{not planBean.planPositionsBean.editing and permissions.canEdit}">
                <img src="/collaboratorium-theme/images/icon_edit-page.gif" width="19" height="21" alt=" " /> 
                <ice:commandLink value="edit page" actionListener="#{planBean.planPositionsBean.edit}" />
            </ice:panelGroup>
             -->
            <div class="breadbutt"> 
                <a href="javascript:;" id="showhistory" onclick="triggerVersionsContainerVisibility();">
                    <img src="/collaboratorium-theme/images/icon_show-history.gif" width="23" height="21" alt=" " />
                    <span class="hidden">hide history</span><span class="versionsTrigger">show history</span>
                </a>
            </div>
        </ui:define>
    </ui:decorate>

    <div class="versionsContainer">
        <div class="versions">
            <ice:dataTable value="#{planBean.planPositionsBean.planPositionsVersions}" rows="10" var="historyItem" styleClass="basicTable" rowClasses="odd,even">
                <ice:column>
                    <f:facet name="header">
                        <ice:outputText value="Date"/>
                    </f:facet>
                    <ice:commandLink value="#{historyItem.updateDate}" actionListener="#{planBean.planPositionsBean.selectVersion}">
                        <f:attribute name="item" value="#{historyItem}"/>
                    </ice:commandLink>


                </ice:column>
                <ice:column>
                    <f:facet name="header">
                        <ice:outputText value="User"/>
                    </f:facet>
                    <collab:userLinkSimple userId="#{historyItem.updateAuthor.userId}" text="#{historyItem.updateAuthor.screenName}"/>


                </ice:column>
            </ice:dataTable>
            <br/>

        </div>
    </div>
    
    <ice:panelSeries value="#{planBean.plan.sections}" var="section">
        <h2>#{section.section.definition.title} #{section.editing}</h2>
        <ice:panelSeries var="term" value="#{section.section.definition.focusArea.terms}" >
            <span><strong>${term.space.name}</strong>: ${term.name}</span>
        </ice:panelSeries>
        <f:subview rendered="#{not section.editing}">
            <ice:commandButton value="EDIT" styleClass="mothButton orange" actionListener="#{section.toggleEditing}" />
            <div>#{section.section.content}</div>
            <br />
            <h3>Referenced plans:</h3> 
            <ice:panelSeries var="refPlan" value="#{section.section.referencedPlans}">
                <collab:planLink planId="#{refPlan.planId}" contestId="#{refPlan.contest.primaryKey}" text="#{refPlan.name}"/>
            </ice:panelSeries>
            
        </f:subview>
        
        <f:subview rendered="#{section.editing}">
            <ice:commandButton value="SAVE" styleClass="mothButton orange" actionListener="#{section.save}" />
            <ice:commandButton value="CANCEL" styleClass="mothButton orange" actionListener="#{section.toggleEditing}" />
            <ice:inputTextarea value="#{section.section.content}" />
            <h3>Referenced plans:</h3>
            
            <ice:selectManyListbox value="#{section.referencedPlanIds}" >
                <f:selectItems value="#{section.plansForReference}" />
            </ice:selectManyListbox>
        </f:subview>
        <br /><br />
    </ice:panelSeries>

</f:view>
