<?xml version="1.0"?>
<f:view xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:liferay-faces="http://liferay.com/tld/faces"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:collab="http://climatecollaboratorium.org/components"
        >

    <div class="top_separator">&amp;nbsp;</div>
    
    <div id="protop">
        <div class="vote">
            <ice:form>
                <ice:commandLink styleClass="prominantButton voteForPlanTrigger_#{plan.plan.planId}"  actionListener="#{plan.plan.vote}"
                    rendered="#{votingPhase and not plan.plan.votedOn}" onclick="if(!deferUntilLogin()) { deferPlanVoteUntilLoggedIn(${plan.plan.planId}); return false; }">
                    <span>VOTE</span> for proposal
                </ice:commandLink>
                <ice:commandLink styleClass="prominantButton"
                    actionListener="#{plan.plan.unvote}" rendered="#{votingPhase and plan.plan.votedOn}">
                    <span>RETRACT</span>vote
                </ice:commandLink>
                <ice:commandLink styleClass="prominantButton" actionListener="#{plan.plan.becomeAFan}"
                    rendered="#{!votingPhase and not plan.plan.userAFan}" onclick="if(!deferUntilLogin()) return false;">
                    <span>SUPPORT</span> proposal
                </ice:commandLink>
                <ice:commandLink styleClass="prominantButton"
                    actionListener="#{plan.plan.unfan}" rendered="#{!votingPhase and plan.plan.userAFan}">
                    <span>RETRACT</span> support
                </ice:commandLink>
            </ice:form>
        </div>
    </div>
    
        <f:subview rendered="#{not plan.editingName}">
            <h1 class="spn">Proposals: &amp;nbsp;
                <ice:outputText styleClass="planName" value="#{plan.plan.name}" escaped="true">
                    <f:converter converterId="StringTruncateConverter"/>
                    <f:attribute name="maxLength" value="35" />
                </ice:outputText>
            </h1>
            <!-- 
            <ice:form style="display: inline">
                <ice:commandLink value="rename" actionListener="#{plan.editName}" rendered="#{permissions.canEdit}"/>
            </ice:form>
             -->
        </f:subview>
        <f:subview rendered="#{plan.editingName}">
            <ice:panelGroup styleClass="hidden ">
                <script type="text/javascript">
                    Collab.nav.addEditorDirtyValidationCallback(checkIfPlanNameDirty);
                </script>
            </ice:panelGroup>
                      
            <ice:form>         
              <h1 class="spn">Proposals: &amp;nbsp;
                <ice:inputText value="#{plan.plan.name}" id="renamePlanName" styleClass='' onchange="jQuery(this).addClass('valueChanged');" partialSubmit="true" required="true" style="float: none; font-size: 20px; padding: 3px 1px; width: 550px;" >
                    <f:attribute name="plan" value="#{plan.plan}"/>
                    <f:validator validatorId="planNameValidator"/>
                    <f:attribute name="planName" value="#{plan.plan.name}" />
                </ice:inputText>
              </h1>

                <ice:message for="renamePlanName" styleClass="renamePlanMessage"/>
            </ice:form>
            <ice:message for="renamePlanName" styleClass="renamePlanMessage"/>
        </f:subview>
                

     <div class="clear"></div>
    

    <ice:panelGroup styleClass="portlet">
        <div class="container">
            <div class="container_top">


            </div>
            <ice:form>


</ice:form>
            <div class="container_middle">
                <div class="content">
                    <ice:form>
                        <ice:panelTabSet styleClass="mainTabs"
                                         columnClasses="admin,description,assumptions,models,actionsImpacts,discussion,team"

                                         selectedIndex="#{plan.selectedTab}">

                            <ice:panelTab label="ADMIN"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'admin'}); return false;"
                                          rendered="#{permissions.canAdmin}" styleClass="admin">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/admin.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                             <ice:panelTab label="DESCRIPTION" styleClass="description-tab"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'description'}); return false;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/description.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="ACTIONS &amp; IMPACTS" styleClass="actionsImpacts #{plan.plan.hasModel ? '' : 'hidden' }"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'actionsimpacts'}); return false;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/actionsImpacts.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                            <ice:panelTab label="SECTIONS" styleClass="sections-tab"
                                          onclick="Collab.nav.navigateAddParams('plans', {tab: 'sections'}); return false;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/sections.xhtml"/>
                                </f:subview>
                            </ice:panelTab>

                            <ice:panelTab label="COMMENTS" styleClass="comments-tab"
                                          onclick="Collab.nav.navigateAddParamsMulti({'plans': {tab: 'comments'}, 'comments': {}}); return false;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/comments.xhtml"/>
                                </f:subview>
                            </ice:panelTab>

                            <ice:panelTab label="TEAM" onclick="Collab.nav.navigateAddParams('plans', {tab: 'team'}); return false;">
                                <f:subview>
                                    <ui:include src="planDetailsTabs/team.xhtml"/>
                                </f:subview>
                            </ice:panelTab>
                        </ice:panelTabSet>
                        
                    </ice:form>
                </div>
            </div>
            <!-- .container_middle -->

           
        </div>
        <!-- .container -->
    </ice:panelGroup>
</f:view>
