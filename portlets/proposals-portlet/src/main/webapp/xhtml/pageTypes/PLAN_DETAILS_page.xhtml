<?xml version="1.0"?>
<f:view
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ice="http://www.icesoft.com/icefaces/component"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:collab="http://climatecollaboratorium.org/facelets">
        
<div class="proposal-head">
    <div class="inner">
        <div class="headline">
            <div class="proposal-image">
                <f:subview rendered="#{not empty proposal.plan.image}">
                    <img src="#{proposal.plan.image}" width="52" height="52" alt="Contest Image" />
                </f:subview>
                <f:subview rendered="#{empty proposal.plan.image}">
                    <img src="/climatecolab-theme/images/proposal_default.png" width="52" height="52" alt="#{proposal.plan.name}" />
                </f:subview>
            </div>
            <div class="proposal-title">
                <div class="prop-description">
                    Proposal for 
                    <collab:contestLink contestId="#{contest.contest.contestId}" text=" #{contest.contest.shortName} " />
                    by
                    <f:subview rendered="#{empty proposal.plan.team}">
                        <collab:userLinkSimple userId="#{proposal.plan.author.userId}" text=" #{proposal.plan.author.screenName}" />
                    </f:subview>
                    <f:subview rendered="#{not empty proposal.plan.team}">
                        #{proposal.plan.team}
                    </f:subview>
                </div>
                <h1>#{proposal.plan.name}</h1>
            </div>
        </div> <!-- /headline -->
        <div class="prop-tabs">
            <ice:form>
                <ul>
                    <ui:repeat value="#{proposal.availableTabs}" var="tabWrapper">
                        <li class="#{proposal.currentTab == tabWrapper.tab ? 'c' : ''}">
                            <ice:commandLink value="#{tabWrapper.displayName}" onclick="Collab.nav.navigateAddParams('plans', {tab: '#{tabWrapper.tab}'}); return false;" >
                                <f:subview rendered="#{tabWrapper.hasActivityCount}">
                                    <div>#{tabWrapper.activityCount}</div>
                                </f:subview>
                            </ice:commandLink>
                        </li>
                    </ui:repeat>
                </ul>
            </ice:form>
        </div>
    </div> <!-- /inner -->
</div> <!-- /proposal-head -->



    <ice:panelGroup styleClass="edit-prop-wrap" rendered="#{not proposal.editing and proposal.currentTab.editable}">
        <div class="inner">
            <div class="edit-prop">
                <ice:form>
                    <div class="edit-prop-butts">
                        <ice:commandLink value="Edit" actionListener="#{planBean.toggleEditing}" 
                                rendered="#{permissions.canEdit and plan.currentTab.editable and not plan.editing}" 
                                styleClass="#{planBean.plan.viewingLatest ? '' : 'disabled'}" 
                                disabled="#{not planBean.plan.viewingLatest}" />
                        <f:subview rendered="#{ proposal.currentTab.hasHistory}">
                            <a href="javascript:;" onclick="triggerVersionsContainerVisibility();" id="versionContainerTrigger">Show history</a>
                        </f:subview>
                    </div>
                    <f:subview rendered="#{not planBean.plan.viewingLatest}">
                        <div class="lastedited">
                            Currently viewing version from #{planBean.plan.updated} by&amp;nbsp;
                            <collab:userLinkSimple userId="#{planBean.plan.updateAuthorId}" text="#{planBean.plan.updateAuthorScreenName}" />
                        </div> 
                        <div class="edit-prop-butts">
                            &amp;nbsp;
                            &amp;nbsp;
                            <f:subview styleClass="edit-prop-butts" rendered="#{permissions.canEdit}">
                                <ice:commandLink value="Revert" actionListener="#{planBean.plan.revertTo}" />
                            </f:subview>
                            <ice:commandLink value="Go to current" actionListener="#{planBean.plan.goToCurrent}" />
                        </div>
                    
                    </f:subview>
                    <!-- <div class="lastedited">Last edited 5 days ago by <a href="javascript:;">&amp;nbsp;beachbabe-in-fl</a></div>-->
                </ice:form>
            </div>
        </div>
    </ice:panelGroup>
 

<div id="content">
    <ui:include src="./plan/tab_#{proposal.currentTab}#{proposal.editing and proposal.currentTab.editable ? '_edit' : '' }.xhtml" />
</div>
 
</f:view>
