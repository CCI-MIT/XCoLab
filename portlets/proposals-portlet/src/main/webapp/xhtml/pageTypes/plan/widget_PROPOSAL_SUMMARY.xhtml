<f:view 
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:collab="http://climatecollaboratorium.org/facelets"
    xmlns:ice="http://www.icesoft.com/icefaces/component"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:addthis="http://www.addthis.com/help/api-spec" >

    <div class="prop-right">
        <div class="votebox-wrap">
            <div class="votebox-shade">
                <div class="votebox">
                    <f:subview rendered="#{votingPhase}">
                        <div class="votebox-top clearfix">
                            <div class="vote">
                                <img src="/climatecolab-theme/images/icon-proposal-vote.png" width="22" height="18" alt="Vote" /> 
                                <span>#{proposal.plan.votes}</span> votes
                                <div class="blue-button">
                                    <ice:commandLink styleClass="voteForPlanTrigger_#{plan.plan.planId}"  actionListener="#{plan.plan.vote}"
                                            rendered="#{votingPhase and not plan.plan.votedOn}" 
                                            onclick="if(!deferUntilLogin()) { deferPlanVoteUntilLoggedIn(${plan.plan.planId}); return false; }">
                                    
                                        VOTE for proposal
                                    </ice:commandLink>
                                    <ice:commandLink actionListener="#{plan.plan.unvote}" rendered="#{votingPhase and plan.plan.votedOn}">
                                        RETRACT vote
                                    </ice:commandLink>
                                </div>
                            </div>
                            <div class="question"><a href="javascript:;"> 
                                <img src="/climatecolab-theme/images/icon-proposal-question.png" width="23" height="23" alt="Question?" />
                            </a></div>
                        </div>
                    </f:subview>
                    <div class="votebox-bottom">
                        <img src="/climatecolab-theme/images/icon-proposal-thumb.png" width="20" height="22" alt="Thumbs up" />
                        <span>#{planBean.plan.planFansCount}</span> supporters 
                        <ice:commandLink actionListener="#{plan.plan.becomeAFan}" rendered="#{!votingPhase and not plan.plan.userAFan and proposal.plan.lastInGroup}" 
                                onclick="if(!deferUntilLogin()) return false;">Support proposal</ice:commandLink>
                        <ice:commandLink actionListener="#{plan.plan.unfan}" rendered="#{!votingPhase and plan.plan.userAFan and proposal.plan.lastInGroup}">
                            Retract support</ice:commandLink>
                    </div>
                </div> <!-- /votebox -->
            </div> <!-- /votebox shade -->
        </div> <!-- /votebox wrapper -->
 
        <div class="share">
            <div class="addthis_toolbox addthis_default_style addthis_32x32_style" id="shareProposalToolbox" style="float: left;">
                <a class="addthis_button_facebook" id="addThisButton1" addthis:title="#{proposal.plan.name}" addthis:description="#{proposal.plan.pitch}"></a>
                <a class="addthis_button_twitter" id="addThisButton2" addthis:title="#{proposal.plan.name}" addthis:description="#{proposal.plan.pitch}"></a>
                <a class="addthis_button_email" id="addThisButton3" addthis:title="#{proposal.plan.name}" addthis:description="#{proposal.plan.pitch}"></a>
            </div>
             <f:subview rendered="#{planBean.plan.subscribed and proposal.plan.lastInGroup}">
                <div class="info subscribe" style="float:left;">
                    <ice:commandLink actionListener="#{planBean.plan.subscribe}" onclick="if(!deferUntilLogin()) return false;" ><img src="/climatecolab-theme/images/unsubscribe.png" />&#160; Unsubscribe</ice:commandLink>
                </div>
            </f:subview>
        
            <f:subview rendered="#{not planBean.plan.subscribed and proposal.plan.lastInGroup}">
                <div class="info subscribe" style="float:left;">
                    <ice:commandLink actionListener="#{planBean.plan.subscribe}" onclick="if(!deferUntilLogin()) return false;" ><img src="/climatecolab-theme/images/icon_star.png" />&#160; Subscribe</ice:commandLink>
                </div>
            </f:subview>
            
            <script type="text/javascript">
                if (typeof(addthis) != 'undefined') {
                    // #{navigation.forceRerender}
                    addthis.toolbox("#shareProposalToolbox");
                }
            </script>
            <div class="clear"></div>
        </div>
        
 
        <h5 class="topbox">Proposal Summary</h5>
  
        <div class="prop-title addprop">
            #{proposal.plan.name}
        </div>

        <div class="prop-settings">
            <f:subview rendered="#{proposal.plan.open}">
                <strong>Public Proposal:</strong> Anyone will be able to edit this proposal.&#160;
                <f:subview rendered="#{permissions.canAdmin}">
                    <a href="javascript:;" onclick="Collab.nav.navigateAddParams('plans', {tab: 'admin'}); return false;">Change settings</a>
                </f:subview>
            </f:subview>
            <f:subview rendered="#{not proposal.plan.open}">
                <strong>Team Proposal:</strong> Only team members will be able to edit this proposal.&#160;
                <f:subview rendered="#{permissions.canAdmin}">
                    <a href="javascript:;" onclick="Collab.nav.navigateAddParams('plans', {tab: 'admin'}); return false;">Change settings</a>
                </f:subview>
            </f:subview>
        </div>

        <div class="prop-avatar">
            <collab:userPortrait screenName="#{empty proposal.plan.team ? proposal.plan.author.screenName : ''}" portraitId="#{proposal.plan.author.portraitId}" width="42" height="42" />
            By:&#160;
                <f:subview rendered="#{empty proposal.plan.team}">
                    <collab:userLinkSimple userId="#{proposal.plan.author.userId}" text="#{proposal.plan.author.screenName}" />
                </f:subview>
                <f:subview rendered="#{not empty proposal.plan.team}">
                    #{proposal.plan.team}
                </f:subview>
        </div>

        <div class="prop-contest">
            <strong>Contest:</strong>  
            <collab:contestLink contestId="#{contest.contest.contestId}" text=" #{contest.contest.shortName} " /><br />
            #{contest.contest.name}
        </div>
        
        <div class="prop-avatar" style="font-size: 13px">
            <f:subview rendered="#{planBean.plan.regional}" styleClass="grid-blue">
                <strong>REGION</strong><br />
                <em>Economy:</em> #{planBean.plan.regionEconomy}<br />
                <em>Transnational group/large country:</em> #{planBean.plan.attributes['REGION']}<br />
                <f:subview rendered="#{not empty planBean.plan.subregion}">
                    <em>Country within transnational group:</em> #{planBean.plan.attributes['SUBREGION']}
                </f:subview>
            </f:subview>  
        </div>
  
        <f:subview rendered="#{planBean.plan.hasModel}">
            <h5 class="toppad">Model Results Summary</h5>
            <div class="div3"></div>
            <div class="prop-results">
                <div><strong>CO2 concentration</strong><br />#{planBean.plan.attributes['CO2_CONCENTRATION']} ppm in 2100</div>
                <div><strong>Temperature Increase</strong><br />#{planBean.plan.attributes['TEMP_CHANGE']} &amp;deg;C</div>
                <div><strong>Mitigation Costs</strong><br />#{planBean.plan.attributes['MITIGATION_COST_NO_ERRORS']} %GDP in 2100</div>
                <div><strong>Damage Costs</strong><br />#{planBean.plan.attributes['DAMAGE_COST']} %GDP in 2100</div>
            </div>
        </f:subview>
    </div> <!-- /prop-right -->
</f:view>