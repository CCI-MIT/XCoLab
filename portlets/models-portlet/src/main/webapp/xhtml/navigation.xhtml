<?xml version="1.0"?>
<!--
  ~ Copyright (c) 2010. M.I.T. All Rights Reserved
  ~ Licensed under the MIT license. Please see http://www.opensource.org/licenses/mit-license.php
  ~ or the license.txt file included in this distribution for the full text of the license.
  -->

<f:view xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ice="http://www.icesoft.com/icefaces/component" 
    xmlns:liferay-faces="http://liferay.com/tld/faces">    
    
<script language="javascript">
/** HISTORY MANAGEMENT STUFF */

function pageload() {
    var fragment = window.location.hash;
    if (fragment.indexOf("?") >= 0) {
        var query = fragment.substring(fragment.indexOf("?"), fragment.length);
        var hash = fragment.substring(0, fragment.indexOf("?"));
        var location = window.location.href.substring(0, window.location.href.indexOf("#"));
        window.location = location + query + hash;
        return;
    }
    var frag = getFragments();
    if (!frag) {
        forceNav(0);
        return;
    }
    forceNav(frag["modelId"]);
}

jQuery(document).ready(function(){
    // Initialize history plugin.
    // The callback is called at once by present location.hash.
     jQuery.history.init(pageload);
});    

/* this method should update address when item is added but doesn't work currently */
function updateIfNew(debate, item) {
    /*var currentFrag = getFragments();
    if (currentFrag) {
        alert(currentFrag['debate'] + "\t" + currentFrag['item'] + "\n" + debate + "\t" + item);
    }
    */
} 

function getFragments() {
    var fragment = window.location.hash;
    // remove everything after question mark
    if (fragment.indexOf("?") >= 0) {
        fragment = fragment.substring(0, fragment.indexOf("?"));
    }
    if (fragment.length == 0) return false;
    var result = new Object();
    var segments = fragment.substring(1).split(";");
    jQuery.each(segments, function(idx,val) {
        if (val.indexOf("=") &lt; 1) return true;
        var entry = val.split("=");
        result[entry[0]] = entry[1];
    });
    return result;
}

function forceNav(model) {
    jQuery("#navigationForm .debateId").val(model);
    jQuery("#navigationForm .navSubmit").click();

}
</script>    
    <div id="navigationForm" style="display:none" class="hidden">
        <ice:form id="myform">
            <ice:inputText value="#{navigation.modelId}" styleClass="debateId" />
            <ice:commandButton actionListener="#{navigation.update}" styleClass="navSubmit" />
        </ice:form>
    </div> 
</f:view>