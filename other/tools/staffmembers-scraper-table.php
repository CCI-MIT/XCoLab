<?php

//fill in the html table from the staffmembers about pages here

$table = '
<div class="wiki-borderless"> <table class="wikitable" style="border: 0px;"> <tbody> <tr class="odd" style="border: 0px;"> <td style="border: 0px; width: 33%;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/191931">Zak Accuardi</a><br> <br> MIT Technology<br> and Policy <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px; width: 33%;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005880&amp;t=1359671411319" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px; width: 33%;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006175">Abdulla</a><br> <a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006175">AlMisnad</a><br> MIT Technology<br> and Policy <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006345&amp;t=1359671896501" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1004996">Alex Aylett</a><br> MIT Technology<br> and Policy <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005854&amp;t=1361789300117" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006449">Noel Bakhtian</a><br> Energy Fellow<br> Senator Office <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006463&amp;t=1361782994839" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006511">Ashaya Basnyat</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006523&amp;t=1361783363577" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006026">Martha Belden</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006040&amp;t=1361783503757" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1004145">Alex Borschow</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006136&amp;t=1361783628657" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1009728">Matt Cashman</a><br> L.E.K.<br> Consulting <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1011329&amp;t=1365375002860" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005993">John Dugger</a><br> <br> &nbsp; <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1008733&amp;t=1361783726658" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/190000">Erik Duhaime</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=192646&amp;t=1345152135390" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006245">Julia Eiferman</a><br> Columbia<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006326&amp;t=1361784001735" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006346">Eric Hong</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006360&amp;t=1361784317290" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/152244">Paul Kishimoto</a><br> MIT Technology<br> and Policy <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1003850&amp;t=1361788770003" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1002427">Alex Kwan</a><br> Khazanah<br> Nasional Berhad <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005964&amp;t=1361784490918" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1004737">Ashwin Kumar</a><br> Carnegie<br> Mellon <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1004838&amp;t=1361784605971" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006476">Peter Leung</a><br> Columbia<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006527&amp;t=1361784686963" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005881">Yichen Lu</a><br> Duke<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005895&amp;t=1361785125545" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1003655">Sara Magalhaes</a><br> MIT Portugal<br> Program <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006712&amp;t=1361785329550" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1008441">Liz Marcello</a><br> Global Cities Inc.<br> &nbsp; <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1008456&amp;t=1361785403768" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/33569">Mike Matessa</a><br> Climate CoLab<br> Project Team <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=163012&amp;t=1345152204558" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006327">Ajith Rao</a><br> Regulatory Assistance<br> Project <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1010555" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005084">Michael Reading</a><br> Tufts<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006024&amp;t=1361785820979" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006208">Frank Reig</a><br> Columbia<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006290&amp;t=1361785880517" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006160">Christopher Rhie</a><br> MIT Architecture<br> &amp; Planning <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1010395&amp;t=1361785956956" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1013213">Paul Rogerson</a><br> UCS<br> &nbsp; <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1013227&amp;t=1365375229159" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1007188">Roger Sathre</a><br> Lawrence<br> Berkeley <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1007203&amp;t=1361786009102" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1004796">Ryan Sheinbein</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1004810&amp;t=1361786104753" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1006293">Clara Suh</a><br> MIT Architecture<br> &amp; Planning <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006322&amp;t=1361786221593" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005911">Christyn Takara</a><br> Columbia<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005936&amp;t=1361786263763" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005896">Elyse Tyson</a><br> MIT Sloan<br> School <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1005910&amp;t=1361786354243" width="120"></td> </tr> </tbody> </table> </td> </tr> <tr style="border: 0px;"> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> <td style="border: 0px;">&nbsp;</td> </tr> <tr class="odd" style="border: 0px;"> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1005937">Katie Walsh</a><br> Tufts<br> University <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1006121&amp;t=1361786402587" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;"><a class="external" href="http://climatecolab.org/web/guest/member/-/member/userId/1014651">Sanjeev Naik</a><br> Consultant<br> &nbsp; <table class="imageplugin" style="border: 0px;"> <tbody> <tr style="border: 0px;"> <td style="border: 0px;"><img src="http://climatecolab.org/image/user_male_portrait?img_id=1001233" width="120"></td> </tr> </tbody> </table> </td> <td style="border: 0px;">&nbsp;</td> </tr> </tbody> </table> </div>

';
//and set the category id
$categoryId = 12;

/*
LEGEND for categoryId

categories.put(1, "Modeling Steering Committee: External Members");
categories.put(2, "Modeling Steering Committee: Climate CoLab Staff");
categories.put(3, "Expert Advisory Board");
categories.put(4, "Expert Council");
categories.put(5, "Project Staff: Team");
categories.put(6, "Project Staff: Vendors");
categories.put(7, "Project Staff: Advisors");
categories.put(8, "Project Staff: Alumni");
categories.put(9, "Advisors");
categories.put(10, "Judges");
categories.put(11, "Fellows 2014");
categories.put(12, "Fellows 2012 & 2013");
categories.put(13, "Catalysts");


*/




$con = mysqli_connect("localhost", "root", "", "xcolab");
// Check connection
if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
}


$e = '(<br ?/?>|\s*|&nbsp;)*';
preg_match_all('#<td[^>]*>'.$e.'(.*?)'.$e.'<a[^>]*href="([^"]*)"[^>]*>([^<]*)</a>('.$e.'<a.*?/a>)?'.$e.'(.*?)'.$e.'<table.*?<img[^>]*src="([^"]*)".*?table>.*?</td>#si',
$table, $matches);

echo "Matches: ".count($matches[0])."<br>";
echo "<textarea style='font-family: Courier;float:left;width:50%;height:2000px'>";


$cclUrl = 'http://climatecolab.org/web/guest/member/-/member/userId/';

for ($i = 0; $i < count($matches[0]); $i++) {
	$role = trim(strip_tags($matches[2][$i]));
	$url = $matches[4][$i];
	$name = $matches[5][$i];
	$organization = trim(strip_tags($matches[9][$i]));
	$photoUrl = $matches[11][$i];
	
	$doNotAddUrl = false;
	
	$portraitId = null;
	$userId = null;

	//first, see if the profile link leads directly to the ccl profile
	if (strpos($url, $cclUrl) !== false || strpos($url, "/web/") === 0) {
		if (substr($url, count($url)-2) == "/") {
			$url = substr($url, 0, -1);
		}
		$userId = substr($url, strrpos($url, "/")+1);
		$doNotAddUrl = true;
	//else, look for portait id in photoUrl
	} else {
		if (strpos($photoUrl, "http://climatecolab.org/image/") !== false || strpos($photoUrl, "/image/") === 0) {
			$portraitId = preg_replace('#^.*?img_id=(\d+).*?$#si', '$1', $photoUrl);
		}


		if ($portraitId) {
			$result = mysqli_query($con, "SELECT userId FROM xcolab.User_ WHERE portraitId = '".$portraitId."';");

			$row = mysqli_fetch_array($result);
			if ($row["userId"]) {
				$userId = $row["userId"];
			}
		}
	}



	echo 'INSERT INTO xcolab_StaffMember'."\n";
	
	if ($userId) {
		echo "	    (userId, categoryId, sort, url, role, organization)\n	VALUES (\n";
		echo "--  ".$name."\n";
		echo "	   $userId, $categoryId, $i, ";
		if ($doNotAddUrl) {
			echo " NULL, ";
		} else {
			echo "'".$url."', ";
		}
		echo "'".trim($role)."', ";
		echo "'".$organization."'\n";
	} else {
		$names = explode(" ", $name);
		echo "	    (categoryId, firstNames, lastName, url,
		    photoUrl, sort, role, organization)\n	VALUES (\n";
		echo "	   $categoryId,";
		echo "'".$names[0]."', ";
		echo "'".@$names[1]."', \n";
		echo "    '".$url."', ";
		echo "	   '".$photoUrl."', \n";
		echo "	   $i, ";
		echo "'".$role."', ";
		echo "'".$organization."'\n";
	}
	
	echo ');'."\n\n";
}
echo "</textarea>";
echo '<div style="width:50%;float:right">';
echo $table;
echo '</div>';




mysqli_close($con);